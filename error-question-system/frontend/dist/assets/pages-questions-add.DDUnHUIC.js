import{_ as e,m as t,c as a,w as s,s as l,D as o,E as r,G as i,H as n,J as c,i as d,o as u,e as f,k as m,j as g,I as h,l as p,h as y,t as _,C,K as D,A as I,F as k,B as x,f as w,u as V}from"./index-C1huu0wr.js";const v=e({data:()=>({formData:{title:"",categoryId:"",content:"",images:[],answer:"",solution:"",difficulty:2,tags:[]},errors:{title:"",categoryId:"",content:"",answer:"",solution:""},categoryOptions:[],selectedCategory:{},selectedCategoryIndex:0,difficultyOptions:[{id:1,name:"简单"},{id:2,name:"中等"},{id:3,name:"困难"}],tagInput:"",isLoading:!1}),onLoad(){this.loadCategories()},methods:{...t("questions",["addQuestion","uploadQuestionImage"]),...t("categories",["getCategoryList"]),async loadCategories(){try{await this.getCategoryList(),this.categoryOptions=this.categories.map(e=>({id:e.id,name:e.name}))}catch(e){console.error("加载分类列表失败:",e),l({title:"加载分类失败",icon:"none"})}},handleCategoryChange(e){this.selectedCategoryIndex=e.detail.value,this.selectedCategory=this.categoryOptions[this.selectedCategoryIndex],this.formData.categoryId=this.selectedCategory.id},selectDifficulty(e){this.formData.difficulty=e},chooseImage(){c({count:3-this.formData.images.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{this.uploadImages(e.tempFilePaths)}})},async uploadImages(e){i({title:"上传中..."});try{for(const t of e){const e=await this.uploadQuestionImage(t);this.formData.images.push(e.url)}n(),l({title:"上传成功",icon:"success"})}catch(t){n(),console.error("上传图片失败:",t),l({title:"上传失败",icon:"none"})}},previewImage(e){r({current:e,urls:this.formData.images})},deleteImage(e){this.formData.images.splice(e,1)},addTag(){this.tagInput.trim()&&(this.formData.tags.length>=5?l({title:"最多添加5个标签",icon:"none"}):this.formData.tags.includes(this.tagInput.trim())?l({title:"标签已存在",icon:"none"}):(this.formData.tags.push(this.tagInput.trim()),this.tagInput=""))},deleteTag(e){this.formData.tags.splice(e,1)},validateForm(){let e=!0;return this.errors={title:"",categoryId:"",content:"",answer:"",solution:""},this.formData.title.trim()||(this.errors.title="请输入题目标题",e=!1),this.formData.categoryId||(this.errors.categoryId="请选择错题分类",e=!1),this.formData.content.trim()||(this.errors.content="请输入题目内容",e=!1),this.formData.answer.trim()||(this.errors.answer="请输入题目答案",e=!1),this.formData.solution.trim()||(this.errors.solution="请输入解题思路",e=!1),e},async handleSubmit(){if(this.validateForm()){this.isLoading=!0;try{await this.addQuestion(this.formData),l({title:"添加成功",icon:"success"}),setTimeout(()=>{o()},1500)}catch(e){console.error("添加错题失败:",e),l({title:e.message||"添加失败，请重试",icon:"none"})}finally{this.isLoading=!1}}}}},[["render",function(e,t,l,o,r,i){const n=d,c=h,v=y,b=C,L=D,T=w,O=V;return u(),a(n,{class:"add-question-page"},{default:s(()=>[f(n,{class:"form-container"},{default:s(()=>[f(n,{class:"form-section"},{default:s(()=>[f(n,{class:"section-title"},{default:s(()=>[g("题目标题")]),_:1}),f(c,{class:p(["form-input",{error:r.errors.title}]),placeholder:"请输入题目标题",modelValue:r.formData.title,"onUpdate:modelValue":t[0]||(t[0]=e=>r.formData.title=e)},null,8,["modelValue","class"]),r.errors.title?(u(),a(v,{key:0,class:"error-text"},{default:s(()=>[g(_(r.errors.title),1)]),_:1})):m("",!0)]),_:1}),f(n,{class:"form-section"},{default:s(()=>[f(n,{class:"section-title"},{default:s(()=>[g("错题分类")]),_:1}),f(b,{mode:"selector",range:r.categoryOptions,"range-key":"name",onChange:i.handleCategoryChange,value:r.selectedCategoryIndex},{default:s(()=>[f(n,{class:p(["picker-wrapper",{error:r.errors.categoryId}])},{default:s(()=>[f(v,{class:"picker-text"},{default:s(()=>[g(_(r.selectedCategory.name||"请选择分类"),1)]),_:1}),f(v,{class:"picker-arrow"},{default:s(()=>[g("▼")]),_:1})]),_:1},8,["class"])]),_:1},8,["range","onChange","value"]),r.errors.categoryId?(u(),a(v,{key:0,class:"error-text"},{default:s(()=>[g(_(r.errors.categoryId),1)]),_:1})):m("",!0)]),_:1}),f(n,{class:"form-section"},{default:s(()=>[f(n,{class:"section-title"},{default:s(()=>[g("题目内容")]),_:1}),f(L,{class:p(["form-textarea",{error:r.errors.content}]),placeholder:"请输入题目内容",modelValue:r.formData.content,"onUpdate:modelValue":t[1]||(t[1]=e=>r.formData.content=e),maxlength:"1000"},null,8,["modelValue","class"]),f(n,{class:"text-counter"},{default:s(()=>[g(_(r.formData.content.length)+"/1000",1)]),_:1}),r.errors.content?(u(),a(v,{key:0,class:"error-text"},{default:s(()=>[g(_(r.errors.content),1)]),_:1})):m("",!0)]),_:1}),f(n,{class:"form-section"},{default:s(()=>[f(n,{class:"section-title"},{default:s(()=>[g("题目图片")]),_:1}),f(n,{class:"image-upload"},{default:s(()=>[f(n,{class:"image-list"},{default:s(()=>[(u(!0),I(k,null,x(r.formData.images,(e,t)=>(u(),a(n,{class:"image-item",key:t},{default:s(()=>[f(T,{class:"image",src:e,mode:"aspectFill",onClick:e=>i.previewImage(t)},null,8,["src","onClick"]),f(n,{class:"image-delete",onClick:e=>i.deleteImage(t)},{default:s(()=>[g("×")]),_:2},1032,["onClick"])]),_:2},1024))),128)),r.formData.images.length<3?(u(),a(n,{key:0,class:"image-add",onClick:i.chooseImage},{default:s(()=>[f(v,{class:"image-add-icon"},{default:s(()=>[g("+")]),_:1}),f(v,{class:"image-add-text"},{default:s(()=>[g("添加图片")]),_:1})]),_:1},8,["onClick"])):m("",!0)]),_:1}),f(v,{class:"upload-tip"},{default:s(()=>[g("最多可上传3张图片")]),_:1})]),_:1})]),_:1}),f(n,{class:"form-section"},{default:s(()=>[f(n,{class:"section-title"},{default:s(()=>[g("题目答案")]),_:1}),f(L,{class:p(["form-textarea",{error:r.errors.answer}]),placeholder:"请输入题目答案",modelValue:r.formData.answer,"onUpdate:modelValue":t[2]||(t[2]=e=>r.formData.answer=e),maxlength:"1000"},null,8,["modelValue","class"]),f(n,{class:"text-counter"},{default:s(()=>[g(_(r.formData.answer.length)+"/1000",1)]),_:1}),r.errors.answer?(u(),a(v,{key:0,class:"error-text"},{default:s(()=>[g(_(r.errors.answer),1)]),_:1})):m("",!0)]),_:1}),f(n,{class:"form-section"},{default:s(()=>[f(n,{class:"section-title"},{default:s(()=>[g("解题思路")]),_:1}),f(L,{class:p(["form-textarea",{error:r.errors.solution}]),placeholder:"请输入解题思路",modelValue:r.formData.solution,"onUpdate:modelValue":t[3]||(t[3]=e=>r.formData.solution=e),maxlength:"1000"},null,8,["modelValue","class"]),f(n,{class:"text-counter"},{default:s(()=>[g(_(r.formData.solution.length)+"/1000",1)]),_:1}),r.errors.solution?(u(),a(v,{key:0,class:"error-text"},{default:s(()=>[g(_(r.errors.solution),1)]),_:1})):m("",!0)]),_:1}),f(n,{class:"form-section"},{default:s(()=>[f(n,{class:"section-title"},{default:s(()=>[g("难度等级")]),_:1}),f(n,{class:"difficulty-selector"},{default:s(()=>[(u(!0),I(k,null,x(r.difficultyOptions,(e,t)=>(u(),a(n,{class:p(["difficulty-item",{active:r.formData.difficulty===e.id}]),key:e.id,onClick:t=>i.selectDifficulty(e.id)},{default:s(()=>[f(v,{class:"difficulty-text"},{default:s(()=>[g(_(e.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),f(n,{class:"form-section"},{default:s(()=>[f(n,{class:"section-title"},{default:s(()=>[g("标签")]),_:1}),f(n,{class:"tag-input-wrapper"},{default:s(()=>[f(c,{class:"tag-input",placeholder:"输入标签后按回车添加",modelValue:r.tagInput,"onUpdate:modelValue":t[4]||(t[4]=e=>r.tagInput=e),onConfirm:i.addTag},null,8,["modelValue","onConfirm"]),f(O,{class:"tag-add-btn",onClick:i.addTag},{default:s(()=>[g("添加")]),_:1},8,["onClick"])]),_:1}),f(n,{class:"tag-list"},{default:s(()=>[(u(!0),I(k,null,x(r.formData.tags,(e,t)=>(u(),a(n,{class:"tag-item",key:t},{default:s(()=>[f(v,{class:"tag-text"},{default:s(()=>[g(_(e),1)]),_:2},1024),f(v,{class:"tag-delete",onClick:e=>i.deleteTag(t)},{default:s(()=>[g("×")]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}),f(n,{class:"form-section"},{default:s(()=>[f(O,{class:"submit-btn",onClick:i.handleSubmit,disabled:r.isLoading},{default:s(()=>[g(_(r.isLoading?"提交中...":"提交"),1)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-f6aaefd8"]]);export{v as default};
