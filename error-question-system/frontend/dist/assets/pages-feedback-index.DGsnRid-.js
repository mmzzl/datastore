import{_ as e,m as t,c as a,w as s,a as o,s as l,E as i,G as c,H as r,J as n,i as d,o as m,e as u,k as f,j as g,A as p,F as y,B as h,l as k,h as b,t as _,K as D,I as F,f as S,u as C}from"./index-C1huu0wr.js";const T=e({data:()=>({formData:{type:"",content:"",contact:"",images:[]},errors:{type:"",content:""},feedbackTypes:[{id:"bug",name:"功能异常"},{id:"suggestion",name:"功能建议"},{id:"ui",name:"界面问题"},{id:"performance",name:"性能问题"},{id:"other",name:"其他问题"}],isSubmitting:!1,feedbackHistory:[]}),onLoad(){this.loadFeedbackHistory()},methods:{...t("feedback",["submitFeedback","getFeedbackHistory","uploadFeedbackImage"]),async loadFeedbackHistory(){try{const e=await this.getFeedbackHistory();this.feedbackHistory=e.data||[]}catch(e){console.error("加载反馈历史失败:",e)}},selectType(e){this.formData.type=e,this.errors.type=""},chooseImage(){n({count:3-this.formData.images.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{this.uploadImages(e.tempFilePaths)}})},async uploadImages(e){c({title:"上传中..."});try{for(const t of e){const e=await this.uploadFeedbackImage(t);this.formData.images.push(e.url)}r(),l({title:"上传成功",icon:"success"})}catch(t){r(),console.error("上传图片失败:",t),l({title:"上传失败",icon:"none"})}},previewImage(e){i({current:e,urls:this.formData.images})},deleteImage(e){this.formData.images.splice(e,1)},validateForm(){let e=!0;return this.errors={type:"",content:""},this.formData.type||(this.errors.type="请选择反馈类型",e=!1),this.formData.content.trim()||(this.errors.content="请输入反馈内容",e=!1),e},async handleSubmit(){if(this.validateForm()){this.isSubmitting=!0;try{await this.submitFeedback(this.formData),l({title:"提交成功",icon:"success"}),this.resetForm(),await this.loadFeedbackHistory()}catch(e){console.error("提交反馈失败:",e),l({title:e.message||"提交失败，请重试",icon:"none"})}finally{this.isSubmitting=!1}}},resetForm(){this.formData={type:"",content:"",contact:"",images:[]},this.errors={type:"",content:""}},viewFeedbackDetail(e){let t=`反馈类型：${this.getFeedbackTypeName(e.type)}\n`;t+=`反馈内容：${e.content}\n`,t+=`提交时间：${this.formatDate(e.createdAt)}\n`,t+=`处理状态：${this.getStatusText(e.status)}`,e.reply&&(t+=`\n\n回复内容：${e.reply}`),o({title:"反馈详情",content:t,showCancel:!1})},getFeedbackTypeName(e){const t=this.feedbackTypes.find(t=>t.id===e);return t?t.name:"未知类型"},getStatusText:e=>({pending:"待处理",processing:"处理中",resolved:"已解决",closed:"已关闭"}[e]||"未知状态"),getStatusClass:e=>({pending:"pending",processing:"processing",resolved:"resolved",closed:"closed"}[e]||""),formatDate(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}}},[["render",function(e,t,o,l,i,c){const r=d,n=b,T=D,x=F,I=S,v=C;return m(),a(r,{class:"feedback-page"},{default:s(()=>[u(r,{class:"form-container"},{default:s(()=>[u(r,{class:"form-section"},{default:s(()=>[u(r,{class:"section-title"},{default:s(()=>[g("反馈类型")]),_:1}),u(r,{class:"type-selector"},{default:s(()=>[(m(!0),p(y,null,h(i.feedbackTypes,e=>(m(),a(r,{class:k(["type-item",{active:i.formData.type===e.id}]),key:e.id,onClick:t=>c.selectType(e.id)},{default:s(()=>[u(n,{class:"type-text"},{default:s(()=>[g(_(e.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1}),i.errors.type?(m(),a(n,{key:0,class:"error-text"},{default:s(()=>[g(_(i.errors.type),1)]),_:1})):f("",!0)]),_:1}),u(r,{class:"form-section"},{default:s(()=>[u(r,{class:"section-title"},{default:s(()=>[g("反馈内容")]),_:1}),u(T,{class:k(["form-textarea",{error:i.errors.content}]),placeholder:"请详细描述您遇到的问题或建议...",modelValue:i.formData.content,"onUpdate:modelValue":t[0]||(t[0]=e=>i.formData.content=e),maxlength:"500"},null,8,["modelValue","class"]),u(r,{class:"text-counter"},{default:s(()=>[g(_(i.formData.content.length)+"/500",1)]),_:1}),i.errors.content?(m(),a(n,{key:0,class:"error-text"},{default:s(()=>[g(_(i.errors.content),1)]),_:1})):f("",!0)]),_:1}),u(r,{class:"form-section"},{default:s(()=>[u(r,{class:"section-title"},{default:s(()=>[g("联系方式（选填）")]),_:1}),u(x,{class:"form-input",placeholder:"手机号或邮箱，方便我们回复您",modelValue:i.formData.contact,"onUpdate:modelValue":t[1]||(t[1]=e=>i.formData.contact=e)},null,8,["modelValue"])]),_:1}),u(r,{class:"form-section"},{default:s(()=>[u(r,{class:"section-title"},{default:s(()=>[g("相关截图（选填）")]),_:1}),u(r,{class:"image-upload"},{default:s(()=>[u(r,{class:"image-list"},{default:s(()=>[(m(!0),p(y,null,h(i.formData.images,(e,t)=>(m(),a(r,{class:"image-item",key:t},{default:s(()=>[u(I,{class:"image",src:e,mode:"aspectFill",onClick:e=>c.previewImage(t)},null,8,["src","onClick"]),u(r,{class:"image-delete",onClick:e=>c.deleteImage(t)},{default:s(()=>[g("×")]),_:2},1032,["onClick"])]),_:2},1024))),128)),i.formData.images.length<3?(m(),a(r,{key:0,class:"image-add",onClick:c.chooseImage},{default:s(()=>[u(n,{class:"image-add-icon"},{default:s(()=>[g("+")]),_:1}),u(n,{class:"image-add-text"},{default:s(()=>[g("添加截图")]),_:1})]),_:1},8,["onClick"])):f("",!0)]),_:1}),u(n,{class:"upload-tip"},{default:s(()=>[g("最多可上传3张图片")]),_:1})]),_:1})]),_:1}),u(r,{class:"form-section"},{default:s(()=>[u(v,{class:"submit-btn",onClick:c.handleSubmit,disabled:i.isSubmitting},{default:s(()=>[g(_(i.isSubmitting?"提交中...":"提交反馈"),1)]),_:1},8,["onClick","disabled"])]),_:1}),i.feedbackHistory.length>0?(m(),a(r,{key:0,class:"feedback-history"},{default:s(()=>[u(r,{class:"history-title"},{default:s(()=>[g("我的反馈记录")]),_:1}),(m(!0),p(y,null,h(i.feedbackHistory,e=>(m(),a(r,{class:"history-item",key:e.id,onClick:t=>c.viewFeedbackDetail(e)},{default:s(()=>[u(r,{class:"history-header"},{default:s(()=>[u(r,{class:"history-type"},{default:s(()=>[g(_(c.getFeedbackTypeName(e.type)),1)]),_:2},1024),u(r,{class:k(["history-status",c.getStatusClass(e.status)])},{default:s(()=>[g(_(c.getStatusText(e.status)),1)]),_:2},1032,["class"])]),_:2},1024),u(r,{class:"history-content"},{default:s(()=>[g(_(e.content),1)]),_:2},1024),u(r,{class:"history-time"},{default:s(()=>[g(_(c.formatDate(e.createdAt)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):f("",!0)]),_:1})]),_:1})}],["__scopeId","data-v-7648c465"]]);export{T as default};
