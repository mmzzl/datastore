import{_ as e,m as t,L as s,c as a,w as i,n as l,s as o,a as r,r as c,b as h,g as d,i as n,M as u,o as f,e as m,k as y,h as g,j as _,A as p,F as k,B as S,t as C,l as F,u as w}from"./index-C1huu0wr.js";const R=e({data:()=>({searchKeyword:"",hasSearched:!1,isLoading:!1,searchResults:[],totalResults:0,currentPage:1,pageSize:10,hasMore:!0,searchHistory:[],hotSearchList:["数学","英语","物理","化学","生物","历史","地理","政治"],showFilterModal:!1,showSortModal:!1,sortType:"time_desc",filterForm:{categoryId:"",difficulty:"",timeRange:""},tempFilterForm:{categoryId:"",difficulty:"",timeRange:""},categoryOptions:[],difficultyOptions:[{id:1,name:"简单"},{id:2,name:"中等"},{id:3,name:"困难"}],timeOptions:[{id:"7",name:"最近7天"},{id:"30",name:"最近30天"},{id:"90",name:"最近90天"},{id:"365",name:"最近一年"}],sortOptions:[{id:"time_desc",name:"最新创建"},{id:"time_asc",name:"最早创建"},{id:"difficulty_desc",name:"难度从高到低"},{id:"difficulty_asc",name:"难度从低到高"}]}),computed:{...s("categories",["categories"])},onLoad(){this.loadSearchHistory(),this.loadCategories()},methods:{...t("questions",["searchQuestions"]),...t("categories",["getCategoryList"]),loadSearchHistory(){try{const e=d("searchHistory")||[];this.searchHistory=e.slice(0,10)}catch(e){console.error("加载搜索历史失败:",e)}},saveSearchHistory(e){try{const t=this.searchHistory.indexOf(e);t>-1&&this.searchHistory.splice(t,1),this.searchHistory.unshift(e),this.searchHistory=this.searchHistory.slice(0,10),h("searchHistory",this.searchHistory)}catch(t){console.error("保存搜索历史失败:",t)}},clearHistory(){r({title:"提示",content:"确定要清空搜索历史吗？",success:e=>{if(e.confirm){this.searchHistory=[];try{c("searchHistory")}catch(t){console.error("清空搜索历史失败:",t)}}}})},searchFromHistory(e){this.searchKeyword=e,this.handleSearch()},async loadCategories(){try{await this.getCategoryList(),this.categoryOptions=this.categories.map(e=>({id:e.id,name:e.name}))}catch(e){console.error("加载分类列表失败:",e)}},handleSearch(){this.searchKeyword.trim()?(this.hasSearched=!0,this.currentPage=1,this.hasMore=!0,this.searchResults=[],this.saveSearchHistory(this.searchKeyword.trim()),this.performSearch()):o({title:"请输入搜索关键词",icon:"none"})},async performSearch(){this.isLoading=!0;try{const e={keyword:this.searchKeyword.trim(),page:this.currentPage,pageSize:this.pageSize,sort:this.sortType,categoryId:this.filterForm.categoryId,difficulty:this.filterForm.difficulty,timeRange:this.filterForm.timeRange},t=await this.searchQuestions(e);1===this.currentPage?this.searchResults=t.data:this.searchResults=[...this.searchResults,...t.data],this.totalResults=t.total,this.hasMore=t.data.length===this.pageSize}catch(e){console.error("搜索错题失败:",e),o({title:e.message||"搜索失败，请重试",icon:"none"})}finally{this.isLoading=!1}},loadMore(){this.hasMore&&!this.isLoading&&(this.currentPage++,this.performSearch())},handleClearSearch(){this.searchKeyword="",this.hasSearched=!1,this.searchResults=[],this.totalResults=0,this.currentPage=1,this.hasMore=!0},selectCategory(e){this.tempFilterForm.categoryId=this.tempFilterForm.categoryId===e?"":e},selectDifficulty(e){this.tempFilterForm.difficulty=this.tempFilterForm.difficulty===e?"":e},selectTimeRange(e){this.tempFilterForm.timeRange=this.tempFilterForm.timeRange===e?"":e},resetFilter(){this.tempFilterForm={categoryId:"",difficulty:"",timeRange:""}},applyFilter(){this.filterForm={...this.tempFilterForm},this.showFilterModal=!1,this.hasSearched&&(this.currentPage=1,this.hasMore=!0,this.searchResults=[],this.performSearch())},selectSort(e){this.sortType=e,this.showSortModal=!1,this.hasSearched&&(this.currentPage=1,this.hasMore=!0,this.searchResults=[],this.performSearch())},getSortText(){const e=this.sortOptions.find(e=>e.id===this.sortType);return e?e.name:"最新创建"},goToDetail(e){l({url:`/pages/questions/detail?id=${e}`})},getDifficultyText:e=>({1:"简单",2:"中等",3:"困难"}[e]||"未知"),getDifficultyClass:e=>({1:"easy",2:"medium",3:"hard"}[e]||""),formatDate(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}}},[["render",function(e,t,s,l,o,r){const c=u("u-search"),h=n,d=g,R=u("u-loading-icon"),M=u("u-empty"),H=w,O=u("u-popup");return f(),a(h,{class:"search-page"},{default:i(()=>[m(h,{class:"search-header"},{default:i(()=>[m(h,{class:"search-bar"},{default:i(()=>[m(c,{modelValue:o.searchKeyword,"onUpdate:modelValue":t[0]||(t[0]=e=>o.searchKeyword=e),placeholder:"搜索错题标题、内容或标签","show-action":!1,onSearch:r.handleSearch,onClear:r.handleClearSearch},null,8,["modelValue","onSearch","onClear"])]),_:1}),m(h,{class:"filter-btn",onClick:t[1]||(t[1]=e=>o.showFilterModal=!0)},{default:i(()=>[m(d,{class:"filter-text"},{default:i(()=>[_("筛选")]),_:1}),m(d,{class:"filter-icon"},{default:i(()=>[_("⚙️")]),_:1})]),_:1})]),_:1}),!o.hasSearched&&o.searchHistory.length>0?(f(),a(h,{key:0,class:"search-history"},{default:i(()=>[m(h,{class:"history-header"},{default:i(()=>[m(d,{class:"history-title"},{default:i(()=>[_("搜索历史")]),_:1}),m(d,{class:"history-clear",onClick:r.clearHistory},{default:i(()=>[_("清空")]),_:1},8,["onClick"])]),_:1}),m(h,{class:"history-list"},{default:i(()=>[(f(!0),p(k,null,S(o.searchHistory,(e,t)=>(f(),a(h,{class:"history-item",key:t,onClick:t=>r.searchFromHistory(e)},{default:i(()=>[_(C(e),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):y("",!0),o.hasSearched?y("",!0):(f(),a(h,{key:1,class:"hot-search"},{default:i(()=>[m(h,{class:"hot-title"},{default:i(()=>[_("热门搜索")]),_:1}),m(h,{class:"hot-list"},{default:i(()=>[(f(!0),p(k,null,S(o.hotSearchList,(e,t)=>(f(),a(h,{class:"hot-item",key:t,onClick:t=>r.searchFromHistory(e)},{default:i(()=>[_(C(e),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})),o.hasSearched?(f(),a(h,{key:2,class:"search-results"},{default:i(()=>[o.isLoading?(f(),a(h,{key:0,class:"loading-container"},{default:i(()=>[m(R,{mode:"flower",size:"40"}),m(d,{class:"loading-text"},{default:i(()=>[_("搜索中...")]),_:1})]),_:1})):0===o.searchResults.length?(f(),a(h,{key:1,class:"empty-container"},{default:i(()=>[m(M,{mode:"search",icon:"http://cdn.uviewui.com/uview/empty/search.png",text:"未找到相关错题"})]),_:1})):(f(),a(h,{key:2,class:"result-list"},{default:i(()=>[m(h,{class:"result-header"},{default:i(()=>[m(d,{class:"result-count"},{default:i(()=>[_("找到 "+C(o.totalResults)+" 条结果",1)]),_:1}),m(h,{class:"sort-selector",onClick:t[2]||(t[2]=e=>o.showSortModal=!0)},{default:i(()=>[m(d,{class:"sort-text"},{default:i(()=>[_(C(r.getSortText()),1)]),_:1}),m(d,{class:"sort-arrow"},{default:i(()=>[_("▼")]),_:1})]),_:1})]),_:1}),(f(!0),p(k,null,S(o.searchResults,e=>(f(),a(h,{class:"result-item",key:e.id,onClick:t=>r.goToDetail(e.id)},{default:i(()=>[m(h,{class:"result-title"},{default:i(()=>[_(C(e.title),1)]),_:2},1024),m(h,{class:"result-content"},{default:i(()=>[_(C(e.content),1)]),_:2},1024),m(h,{class:"result-meta"},{default:i(()=>[m(h,{class:"meta-item category"},{default:i(()=>[_(C(e.categoryName),1)]),_:2},1024),m(h,{class:F(["meta-item difficulty",r.getDifficultyClass(e.difficulty)])},{default:i(()=>[_(C(r.getDifficultyText(e.difficulty)),1)]),_:2},1032,["class"]),m(h,{class:"meta-item time"},{default:i(()=>[_(C(r.formatDate(e.createdAt)),1)]),_:2},1024)]),_:2},1024),e.tags&&e.tags.length>0?(f(),a(h,{key:0,class:"result-tags"},{default:i(()=>[(f(!0),p(k,null,S(e.tags,(e,t)=>(f(),a(h,{class:"tag-item",key:t},{default:i(()=>[_(C(e),1)]),_:2},1024))),128))]),_:2},1024)):y("",!0)]),_:2},1032,["onClick"]))),128)),o.hasMore&&!o.isLoading?(f(),a(h,{key:0,class:"load-more"},{default:i(()=>[m(H,{class:"load-more-btn",onClick:r.loadMore},{default:i(()=>[_("加载更多")]),_:1},8,["onClick"])]),_:1})):y("",!0),!o.hasMore&&o.searchResults.length>0?(f(),a(h,{key:1,class:"no-more"},{default:i(()=>[m(d,{class:"no-more-text"},{default:i(()=>[_("没有更多了")]),_:1})]),_:1})):y("",!0)]),_:1}))]),_:1})):y("",!0),m(O,{show:o.showFilterModal,mode:"bottom",round:"10",closeOnClickOverlay:"",onClose:t[4]||(t[4]=e=>o.showFilterModal=!1)},{default:i(()=>[m(h,{class:"filter-modal"},{default:i(()=>[m(h,{class:"modal-header"},{default:i(()=>[m(d,{class:"modal-title"},{default:i(()=>[_("筛选条件")]),_:1}),m(d,{class:"modal-reset",onClick:r.resetFilter},{default:i(()=>[_("重置")]),_:1},8,["onClick"])]),_:1}),m(h,{class:"filter-section"},{default:i(()=>[m(h,{class:"section-title"},{default:i(()=>[_("错题分类")]),_:1}),m(h,{class:"option-list"},{default:i(()=>[(f(!0),p(k,null,S(o.categoryOptions,e=>(f(),a(h,{class:F(["option-item",{active:o.filterForm.categoryId===e.id}]),key:e.id,onClick:t=>r.selectCategory(e.id)},{default:i(()=>[_(C(e.name),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),m(h,{class:"filter-section"},{default:i(()=>[m(h,{class:"section-title"},{default:i(()=>[_("难度等级")]),_:1}),m(h,{class:"option-list"},{default:i(()=>[(f(!0),p(k,null,S(o.difficultyOptions,e=>(f(),a(h,{class:F(["option-item",{active:o.filterForm.difficulty===e.id}]),key:e.id,onClick:t=>r.selectDifficulty(e.id)},{default:i(()=>[_(C(e.name),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),m(h,{class:"filter-section"},{default:i(()=>[m(h,{class:"section-title"},{default:i(()=>[_("创建时间")]),_:1}),m(h,{class:"option-list"},{default:i(()=>[(f(!0),p(k,null,S(o.timeOptions,e=>(f(),a(h,{class:F(["option-item",{active:o.filterForm.timeRange===e.id}]),key:e.id,onClick:t=>r.selectTimeRange(e.id)},{default:i(()=>[_(C(e.name),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),m(h,{class:"modal-actions"},{default:i(()=>[m(H,{class:"modal-btn cancel-btn",onClick:t[3]||(t[3]=e=>o.showFilterModal=!1)},{default:i(()=>[_("取消")]),_:1}),m(H,{class:"modal-btn confirm-btn",onClick:r.applyFilter},{default:i(()=>[_("确定")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["show"]),m(O,{show:o.showSortModal,mode:"bottom",round:"10",closeOnClickOverlay:"",onClose:t[5]||(t[5]=e=>o.showSortModal=!1)},{default:i(()=>[m(h,{class:"sort-modal"},{default:i(()=>[m(h,{class:"modal-header"},{default:i(()=>[m(d,{class:"modal-title"},{default:i(()=>[_("排序方式")]),_:1})]),_:1}),m(h,{class:"option-list"},{default:i(()=>[(f(!0),p(k,null,S(o.sortOptions,e=>(f(),a(h,{class:F(["option-item",{active:o.sortType===e.id}]),key:e.id,onClick:t=>r.selectSort(e.id)},{default:i(()=>[_(C(e.name),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}],["__scopeId","data-v-0b5fd40b"]]);export{R as default};
