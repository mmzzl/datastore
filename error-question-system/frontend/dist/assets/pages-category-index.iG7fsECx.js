import{_ as e,m as a,L as t,c as o,w as s,s as l,a as i,n as c,z as r,i as d,M as n,o as m,e as u,k as h,A as g,h as f,j as y,F as C,B as _,t as p,u as w,I as b,l as k,K as F,N as L}from"./index-C1huu0wr.js";const M=e({data:()=>({searchKeyword:"",isLoading:!0,showAddModal:!1,showEditModal:!1,isEditing:!1,isSubmitting:!1,categoryForm:{id:"",name:"",description:"",color:"#3c9cff"},errors:{name:""},colorOptions:["#3c9cff","#5ac725","#f9ae3d","#f56c6c","#909399","#722ed1","#13c2c2","#eb2f96"]}),computed:{...t("categories",["categories"]),filteredCategories(){return this.searchKeyword?this.categories.filter(e=>e.name.toLowerCase().includes(this.searchKeyword.toLowerCase())||e.description&&e.description.toLowerCase().includes(this.searchKeyword.toLowerCase())):this.categories}},onLoad(){this.loadCategories()},onPullDownRefresh(){this.loadCategories().then(()=>{r()})},methods:{...a("categories",["getCategoryList","addCategory","updateCategory","deleteCategory"]),async loadCategories(){this.isLoading=!0;try{await this.getCategoryList()}catch(e){console.error("加载分类列表失败:",e),l({title:"加载失败",icon:"none"})}finally{this.isLoading=!1}},handleSearch(){},handleClearSearch(){this.searchKeyword=""},goToQuestionList(e){c({url:`/pages/questions/list?categoryId=${e.id}&categoryName=${e.name}`})},editCategory(e){this.isEditing=!0,this.categoryForm={id:e.id,name:e.name,description:e.description||"",color:e.color||"#3c9cff"},this.showEditModal=!0},confirmDelete(e){i({title:"提示",content:`确定要删除"${e.name}"分类吗？删除后该分类下的错题将移至"未分类"。`,success:a=>{a.confirm&&this.handleDelete(e.id)}})},async handleDelete(e){try{await this.deleteCategory(e),l({title:"删除成功",icon:"success"})}catch(a){console.error("删除分类失败:",a),l({title:a.message||"删除失败，请重试",icon:"none"})}},selectColor(e){this.categoryForm.color=e},closeModal(){this.showAddModal=!1,this.showEditModal=!1,this.isEditing=!1,this.resetForm()},resetForm(){this.categoryForm={id:"",name:"",description:"",color:"#3c9cff"},this.errors={name:""}},validateForm(){let e=!0;return this.errors={name:""},this.categoryForm.name.trim()||(this.errors.name="请输入分类名称",e=!1),e},async handleSubmit(){if(this.validateForm()){this.isSubmitting=!0;try{this.isEditing?(await this.updateCategory(this.categoryForm),l({title:"修改成功",icon:"success"})):(await this.addCategory(this.categoryForm),l({title:"添加成功",icon:"success"})),this.closeModal()}catch(e){console.error("提交分类失败:",e),l({title:e.message||"操作失败，请重试",icon:"none"})}finally{this.isSubmitting=!1}}}}},[["render",function(e,a,t,l,i,c){const r=n("u-search"),M=d,S=n("u-loading-icon"),x=f,E=n("u-empty"),V=w,K=b,v=F,A=n("u-popup");return m(),o(M,{class:"category-page"},{default:s(()=>[u(M,{class:"search-bar"},{default:s(()=>[u(r,{modelValue:i.searchKeyword,"onUpdate:modelValue":a[0]||(a[0]=e=>i.searchKeyword=e),placeholder:"搜索错题分类","show-action":!1,onSearch:c.handleSearch,onClear:c.handleClearSearch},null,8,["modelValue","onSearch","onClear"])]),_:1}),u(M,{class:"category-list"},{default:s(()=>[i.isLoading?(m(),o(M,{key:0,class:"loading-container"},{default:s(()=>[u(S,{mode:"flower",size:"40"}),u(x,{class:"loading-text"},{default:s(()=>[y("加载中...")]),_:1})]),_:1})):0===c.filteredCategories.length?(m(),o(M,{key:1,class:"empty-container"},{default:s(()=>[u(E,{mode:"data",icon:"http://cdn.uviewui.com/uview/empty/data.png",text:"暂无分类数据"})]),_:1})):h("",!0),(m(!0),g(C,null,_(c.filteredCategories,e=>(m(),o(M,{class:"category-item",key:e.id},{default:s(()=>[u(M,{class:"category-info",onClick:a=>c.goToQuestionList(e)},{default:s(()=>[u(M,{class:"category-icon"},{default:s(()=>[u(x,{class:"icon-text"},{default:s(()=>[y(p(e.name.charAt(0)),1)]),_:2},1024)]),_:2},1024),u(M,{class:"category-details"},{default:s(()=>[u(M,{class:"category-name"},{default:s(()=>[y(p(e.name),1)]),_:2},1024),e.description?(m(),o(M,{key:0,class:"category-desc"},{default:s(()=>[y(p(e.description),1)]),_:2},1024)):h("",!0),u(M,{class:"category-stats"},{default:s(()=>[u(x,{class:"stats-item"},{default:s(()=>[y(p(e.questionCount||0)+" 道错题",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]),u(M,{class:"category-actions"},{default:s(()=>[u(V,{class:"action-btn edit-btn",onClick:a=>c.editCategory(e)},{default:s(()=>[y("编辑")]),_:2},1032,["onClick"]),u(V,{class:"action-btn delete-btn",onClick:a=>c.confirmDelete(e)},{default:s(()=>[y("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),u(M,{class:"add-btn",onClick:a[1]||(a[1]=e=>i.showAddModal=!0)},{default:s(()=>[u(x,{class:"add-icon"},{default:s(()=>[y("+")]),_:1})]),_:1}),u(A,{show:i.showAddModal||i.showEditModal,mode:"center",round:"10",closeOnClickOverlay:"",onClose:c.closeModal},{default:s(()=>[u(M,{class:"modal-content"},{default:s(()=>[u(M,{class:"modal-title"},{default:s(()=>[y(p(i.isEditing?"编辑分类":"添加分类"),1)]),_:1}),u(M,{class:"form-item"},{default:s(()=>[u(M,{class:"form-label"},{default:s(()=>[y("分类名称")]),_:1}),u(K,{class:k(["form-input",{error:i.errors.name}]),modelValue:i.categoryForm.name,"onUpdate:modelValue":a[2]||(a[2]=e=>i.categoryForm.name=e),placeholder:"请输入分类名称"},null,8,["modelValue","class"]),i.errors.name?(m(),o(x,{key:0,class:"error-text"},{default:s(()=>[y(p(i.errors.name),1)]),_:1})):h("",!0)]),_:1}),u(M,{class:"form-item"},{default:s(()=>[u(M,{class:"form-label"},{default:s(()=>[y("分类描述")]),_:1}),u(v,{class:"form-textarea",modelValue:i.categoryForm.description,"onUpdate:modelValue":a[3]||(a[3]=e=>i.categoryForm.description=e),placeholder:"请输入分类描述（选填）",maxlength:"200"},null,8,["modelValue"]),u(M,{class:"text-counter"},{default:s(()=>[y(p(i.categoryForm.description.length)+"/200",1)]),_:1})]),_:1}),u(M,{class:"form-item"},{default:s(()=>[u(M,{class:"form-label"},{default:s(()=>[y("图标颜色")]),_:1}),u(M,{class:"color-picker"},{default:s(()=>[(m(!0),g(C,null,_(i.colorOptions,e=>(m(),o(M,{class:k(["color-item",{active:i.categoryForm.color===e}]),key:e,style:L({backgroundColor:e}),onClick:a=>c.selectColor(e)},null,8,["style","class","onClick"]))),128))]),_:1})]),_:1}),u(M,{class:"modal-actions"},{default:s(()=>[u(V,{class:"modal-btn cancel-btn",onClick:c.closeModal},{default:s(()=>[y("取消")]),_:1},8,["onClick"]),u(V,{class:"modal-btn confirm-btn",onClick:c.handleSubmit,disabled:i.isSubmitting},{default:s(()=>[y(p(i.isSubmitting?"提交中...":"确定"),1)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["show","onClose"])]),_:1})}],["__scopeId","data-v-131626ab"]]);export{M as default};
