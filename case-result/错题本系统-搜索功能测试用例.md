# 错题本系统 - 搜索功能测试用例

## 1. 测试概述

### 1.1 测试目标
验证错题本系统搜索功能的正确性、健壮性和用户体验，确保搜索模块能够满足用户需求，提供准确的搜索结果和良好的搜索体验。

### 1.2 测试范围
- 搜索历史功能
- 搜索建议功能
- 热门搜索功能
- 题目搜索接口

## 2. 测试环境

- **后端框架**: Django REST Framework
- **数据库**: SQLite (测试环境)
- **测试框架**: Django TestCase + pytest-django
- **认证方式**: JWT Token

## 3. 测试用例

### 3.1 搜索历史测试用例

| 用例ID | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|---------|--------|
| SH-001 | 创建搜索历史 | 用户已认证 | 1. 发送POST请求到搜索接口<br>2. 验证搜索历史记录被创建 | 搜索历史记录成功创建，包含正确的查询内容和结果数量 | 高 |
| SH-002 | 获取搜索历史列表 | 用户已认证，有搜索历史 | 1. 发送GET请求获取搜索历史列表 | 返回用户的所有搜索历史，按创建时间倒序排列 | 高 |
| SH-003 | 按查询内容过滤搜索历史 | 用户已认证，有多条不同查询的搜索历史 | 1. 发送GET请求，带query参数 | 只返回包含指定查询内容的搜索历史 | 中 |
| SH-004 | 获取单条搜索历史详情 | 用户已认证，有搜索历史 | 1. 发送GET请求获取指定ID的搜索历史 | 返回指定搜索历史的详细信息 | 高 |
| SH-005 | 获取不存在的搜索历史 | 用户已认证 | 1. 发送GET请求获取不存在的搜索历史ID | 返回404状态码和适当的错误信息 | 高 |
| SH-006 | 清除搜索历史 | 用户已认证，有搜索历史 | 1. 发送POST请求到clear接口 | 所有搜索历史被成功删除，返回删除数量 | 高 |
| SH-007 | 未认证用户访问搜索历史 | 未登录用户 | 1. 尝试访问搜索历史接口 | 返回401未授权状态码 | 高 |
| SH-008 | 跨用户访问搜索历史 | 用户A已认证，用户B有搜索历史 | 1. 尝试访问用户B的搜索历史 | 无法访问，返回403或404状态码 | 高 |

### 3.2 搜索建议测试用例

| 用例ID | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|---------|--------|
| SS-001 | 创建搜索建议 | 用户已认证 | 1. 发送POST请求创建搜索建议 | 搜索建议成功创建，返回创建的数据 | 高 |
| SS-002 | 获取搜索建议列表 | 用户已认证，有搜索建议 | 1. 发送GET请求获取搜索建议列表 | 返回所有激活的搜索建议，按频率降序排列 | 高 |
| SS-003 | 按查询内容过滤搜索建议 | 用户已认证，有不同关键词的搜索建议 | 1. 发送GET请求，带query参数 | 只返回包含指定查询内容的搜索建议 | 中 |
| SS-004 | 按激活状态过滤搜索建议 | 用户已认证，有激活和非激活的搜索建议 | 1. 发送GET请求，带is_active参数 | 返回符合指定激活状态的搜索建议 | 中 |
| SS-005 | 获取搜索建议接口 | 用户已认证 | 1. 发送GET请求到suggest接口，带q参数 | 返回符合条件的搜索建议列表 | 高 |
| SS-006 | 增加搜索建议频率 | 用户已认证，有搜索建议 | 1. 发送POST请求到increment-frequency接口 | 搜索建议频率成功增加1 | 高 |
| SS-007 | 更新搜索建议 | 用户已认证，有搜索建议 | 1. 发送PUT请求更新搜索建议 | 搜索建议成功更新，返回更新后的数据 | 高 |
| SS-008 | 搜索建议兼容query/suggestion字段 | 用户已认证 | 1. 使用query参数创建搜索建议<br>2. 使用suggestion参数创建搜索建议 | 两种方式都能成功创建搜索建议 | 高 |
| SS-009 | 空搜索关键词处理 | 用户已认证 | 1. 发送GET请求到suggest接口，不带q参数或q为空 | 返回400错误，提示搜索关键词不能为空 | 高 |

### 3.3 热门搜索测试用例

| 用例ID | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|---------|--------|
| PS-001 | 创建热门搜索 | 用户已认证 | 1. 发送POST请求创建热门搜索 | 热门搜索成功创建，返回创建的数据 | 高 |
| PS-002 | 获取热门搜索列表 | 用户已认证，有热门搜索 | 1. 发送GET请求获取热门搜索列表 | 返回所有激活的热门搜索，按搜索次数和时间倒序排列 | 高 |
| PS-003 | 按查询内容过滤热门搜索 | 用户已认证，有不同关键词的热门搜索 | 1. 发送GET请求，带query参数 | 只返回包含指定查询内容的热门搜索 | 中 |
| PS-004 | 按激活状态过滤热门搜索 | 用户已认证，有激活和非激活的热门搜索 | 1. 发送GET请求，带is_active参数 | 返回符合指定激活状态的热门搜索 | 中 |
| PS-005 | 获取单条热门搜索详情 | 用户已认证，有热门搜索 | 1. 发送GET请求获取指定ID的热门搜索 | 返回指定热门搜索的详细信息 | 高 |
| PS-006 | 获取不存在的热门搜索 | 用户已认证 | 1. 发送GET请求获取不存在的热门搜索ID | 返回404状态码和适当的错误信息 | 高 |
| PS-007 | 增加热门搜索次数 | 用户已认证，有热门搜索 | 1. 发送POST请求到increment-count接口 | 热门搜索次数成功增加1，更新最后搜索时间 | 高 |
| PS-008 | 更新热门搜索 | 用户已认证，有热门搜索 | 1. 发送PUT请求更新热门搜索 | 热门搜索成功更新，返回更新后的数据 | 高 |
| PS-009 | 热门搜索兼容query字段 | 用户已认证 | 1. 使用query参数创建/更新热门搜索 | 能成功创建/更新热门搜索，query映射到keyword | 高 |

### 3.4 题目搜索功能测试用例

| 用例ID | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|---------|--------|
| QS-001 | 基本关键词搜索 | 用户已认证 | 1. 发送GET请求到搜索接口，带q参数 | 返回包含指定关键词的题目列表 | 高 |
| QS-002 | 带过滤条件搜索 | 用户已认证 | 1. 发送GET请求，带q、subject、difficulty等参数 | 返回符合所有过滤条件的题目列表 | 高 |
| QS-003 | 空关键词处理 | 用户已认证 | 1. 发送GET请求到搜索接口，q为空 | 返回400错误，提示搜索关键词不能为空 | 高 |
| QS-004 | 搜索结果自动记录历史 | 用户已认证 | 1. 发送GET请求执行搜索 | 搜索历史自动记录，包含搜索参数和结果数量 | 高 |
| QS-005 | 搜索结果自动更新热门搜索 | 用户已认证 | 1. 发送GET请求执行搜索 | 对应的热门搜索次数增加，最后搜索时间更新 | 高 |
| QS-006 | 搜索结果分页 | 用户已认证，有足够多的题目 | 1. 发送GET请求，设置page和page_size参数 | 返回正确分页的结果，包含总数和分页信息 | 中 |
| QS-007 | 搜索服务不可用处理 | 用户已认证 | 1. 模拟搜索服务异常情况 | 返回503状态码，提示搜索服务不可用 | 高 |
| QS-008 | 搜索参数验证 | 用户已认证 | 1. 发送包含无效参数的搜索请求 | 返回400错误，提示参数验证失败 | 高 |

## 4. 测试数据准备

### 4.1 用户数据
- 测试用户：testuser / testpass123

### 4.2 搜索历史测试数据
- 关键词："一元一次方程"，结果数量：10，搜索时间：0.5秒
- 关键词："二元一次方程"，结果数量：5，搜索时间：0.3秒

### 4.3 搜索建议测试数据
- 关键词："一元一次方程求解"，频率：10，状态：激活
- 关键词："二元一次方程求解"，频率：5，状态：激活
- 关键词："非激活搜索建议"，频率：1，状态：非激活

### 4.4 热门搜索测试数据
- 关键词："一元一次方程"，搜索次数：100，状态：激活
- 关键词："二元一次方程"，搜索次数：50，状态：激活
- 关键词："非激活搜索"，搜索次数：1，状态：非激活

## 5. 测试执行计划

### 5.1 执行顺序
1. 模型测试（SearchHistory, SearchSuggestion, PopularSearch）
2. 视图测试（SearchHistoryViewSet, SearchSuggestionViewSet, PopularSearchViewSet）
3. 集成测试（搜索功能与其他模块的交互）

### 5.2 测试执行方式
- 自动化测试：使用Django TestCase和pytest-django
- 手动测试：关键场景的功能验证和用户体验测试

## 6. 风险与注意事项

### 6.1 已知风险
- 搜索功能依赖于题目管理模块，需要确保相关模块正常工作
- 测试环境可能与生产环境存在差异，需要注意环境因素的影响

### 6.2 注意事项
- 所有测试用例需要在认证状态下执行
- 测试过程中需要保证数据的独立性和隔离性
- 需要模拟各种边缘情况，如空输入、无效参数等

## 7. 测试结果记录

| 用例ID | 测试结果 | 执行时间 | 备注 |
|-------|---------|---------|------|
| SH-001 | 待执行 | - | - |
| SH-002 | 待执行 | - | - |
| SH-003 | 待执行 | - | - |
| SH-004 | 待执行 | - | - |
| SH-005 | 待执行 | - | - |
| SH-006 | 待执行 | - | - |
| SH-007 | 待执行 | - | - |
| SH-008 | 待执行 | - | - |
| SS-001 | 待执行 | - | - |
| SS-002 | 待执行 | - | - |
| SS-003 | 待执行 | - | - |
| SS-004 | 待执行 | - | - |
| SS-005 | 待执行 | - | - |
| SS-006 | 待执行 | - | - |
| SS-007 | 待执行 | - | - |
| SS-008 | 待执行 | - | - |
| SS-009 | 待执行 | - | - |
| PS-001 | 待执行 | - | - |
| PS-002 | 待执行 | - | - |
| PS-003 | 待执行 | - | - |
| PS-004 | 待执行 | - | - |
| PS-005 | 待执行 | - | - |
| PS-006 | 待执行 | - | - |
| PS-007 | 待执行 | - | - |
| PS-008 | 待执行 | - | - |
| PS-009 | 待执行 | - | - |
| QS-001 | 待执行 | - | - |
| QS-002 | 待执行 | - | - |
| QS-003 | 待执行 | - | - |
| QS-004 | 待执行 | - | - |
| QS-005 | 待执行 | - | - |
| QS-006 | 待执行 | - | - |
| QS-007 | 待执行 | - | - |
| QS-008 | 待执行 | - | - |

## 8. 结论与建议

### 8.1 测试结论
（待测试执行完成后填写）

### 8.2 改进建议
（待测试执行完成后填写）